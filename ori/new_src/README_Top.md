# 信息传输系统仿真程序使用说明

## 功能概述

`Top.py` 是一个自动化仿真程序，用于模拟信息传输系统在不同场景下的运行情况。程序自动调用各个模块，完成从信源生成、编码、传输、解码到最终接收的完整流程，并计算各项性能指标。

## 支持的场景

### 1. 理想场景
- **信源概率分布**: 等概率分布 (P(0)=0.5, P(1)=0.5)
- **信源编码**: 无
- **信道编码**: 无
- **信道错误传递概率**: 0
- **理论值**: 所有信息率指标应为1，误码率为0

### 2. 一般非理想场景（四种组合）

所有非理想场景使用相同的信源概率分布（P(0)=0.1）和信道错误概率（0.02），但编码组合不同：

#### 2.1 有信源编码 + 有信道编码
- **信源编码**: Huffman编码
- **信道编码**: 重复码 (N=3)

#### 2.2 有信源编码 + 无信道编码
- **信源编码**: Huffman编码
- **信道编码**: 无

#### 2.3 无信源编码 + 有信道编码
- **信源编码**: 无
- **信道编码**: 重复码 (N=3)

#### 2.4 无信源编码 + 无信道编码
- **信源编码**: 无
- **信道编码**: 无

## 使用方法

### 基本用法

```bash
# 运行所有场景（理想场景 + 4种非理想场景组合）
python Top.py -s all 1024

# 只运行所有非理想场景（4种组合）
python Top.py -s non_ideal_all 1024

# 运行单个场景
python Top.py -s ideal 1024                    # 理想场景
python Top.py -s non_ideal_both 1024          # 有信源编码+有信道编码
python Top.py -s non_ideal_source_only 1024   # 有信源编码+无信道编码
python Top.py -s non_ideal_channel_only 1024  # 无信源编码+有信道编码
python Top.py -s non_ideal_none 1024          # 无信源编码+无信道编码

# 使用不同消息长度测试
python Top.py -s all 1024      # 1KB
python Top.py -s all 10240     # 10KB
python Top.py -s all 102400    # 100KB

# 清理临时文件后运行
python Top.py -s all -del 1024

# 显示详细信息
python Top.py -s all -d 1024
```

### 命令行参数

- `MSG_LEN`: 必需参数，消息长度（字节数）
- `-s, --scenario`: 要运行的场景
  - `ideal`: 理想场景
  - `non_ideal_both`: 有信源编码+有信道编码
  - `non_ideal_source_only`: 有信源编码+无信道编码
  - `non_ideal_channel_only`: 无信源编码+有信道编码
  - `non_ideal_none`: 无信源编码+无信道编码
  - `non_ideal_all`: 所有非理想场景（4种组合）
  - `all`: 所有场景（理想+4种非理想）
- `-del, --delete`: 运行前清理临时文件
- `-d, --detail`: 显示详细的执行信息和指标值
- `-h, --help`: 显示帮助信息

## 输出文件结构

```
../data/
├── temp/                           # 临时文件目录
│   ├── datfile/                   # 二进制数据文件
│   │   ├── ideal_source.*.dat
│   │   ├── ideal_channel.*.dat
│   │   ├── non_ideal_both_source.*.dat
│   │   └── ...
│   ├── metrics/                   # 中间指标文件
│   │   ├── ideal_source_metrics.csv
│   │   ├── ideal_channel_metrics.csv
│   │   └── ...
│   └── file_2bit_to_256bit/      # 256元概率分布文件
└── metrics/                       # 最终结果文件
    ├── ideal_res_metrics.csv     # 理想场景结果
    └── non_ideal_res_metrics.csv # 非理想场景结果（包含4种组合）
```

## 计算的指标

程序会计算以下指标：

1. **输入数据率 (rs)**: 固定为1（数据比特/秒）
2. **信源信息率 (Rs)**: 信源每秒产生的信息量，Rs = rs × H(X)
3. **信道数据率 (rc)**: 信道每秒传输的数据量
4. **信道输入信息率 (Rci)**: 进入信道的信息率
5. **信道输出信息率 (Rco)**: 从信道输出的信息率，Rco = IUV × rc
6. **信宿关于信源信息率 (RI)**: 信宿接收到的关于信源的信息率，RI = IXZ × rs
7. **信宿误码率 (er)**: 传输过程中的比特错误率

其中：
- **H(X)**: 信源信息熵（每符号）
- **IUV**: 信道输入输出之间的互信息（每比特）
- **IXZ**: 信源信宿之间的互信息（每比特）

## 结果文件格式

结果文件为CSV格式，包含以下列：

```
输入数据率rs,信源信息率Rs,信道数据率rc,信道输入信息率Rci,信道输出信息率Rco,信宿关于信源信息率RI,信宿误码率er
```

对于 `non_ideal_res_metrics.csv`，文件包含4行数据，分别对应：
1. 有信源编码 + 有信道编码
2. 有信源编码 + 无信道编码
3. 无信源编码 + 有信道编码
4. 无信源编码 + 无信道编码

## 理论值参考

根据表3-1，一般非理想场景的理论值（P(0)=0.1，错误概率0.02）：

| 场景 | Rs | rc | Rci | Rco | RI | er |
|------|-----|-----|-----|-----|-----|-----|
| 有信源编码 有信道编码 | 0.468995594 | 1.406986781 | 0.468995594 | 1.293311907 | 0.465830694 | 0.000298 |
| 有信源编码 无信道编码 | 0.468995594 | 0.468995594 | 0.468995594 | 0.431103969 | 0.413060588 | 0.01 |
| 无信源编码 有信道编码 | 0.468995594 | 3 | 0.468995594 | 1.239181763 | 0.465830694 | 0.000298 |
| 无信源编码 无信道编码 | 0.468995594 | 1 | 0.468995594 | 0.413060588 | 0.413060588 | 0.02 |

## 依赖要求

### 必需文件

确保以下模块文件存在于 `new_src` 目录下：
- `byteSource.py` - 信源生成
- `source_encoder.py` - 信源编码（Huffman）
- `source_decoder.py` - 信源解码
- `channel.py` - 信道模拟（BSC）
- `calcInfo.py` - 信息熵计算
- `calaDMSInfo.py` - DMS信息指标计算
- `channelIndexCalc.py` - 信道互信息计算
- `coding.py` - 信道编码（重复码）
- `decoding.py` - 信道解码

### 输入文件

确保 `input/` 目录下存在以下概率分布文件：
- `p0=0.5.csv` - 等概率分布（用于理想场景）
- `p0=0.1.csv` - P(0)=0.1分布（用于非理想场景）
- `p=0.csv` - 零错误概率（用于理想场景）
- `p=0.01.csv` - 错误概率0.01（用于非理想场景）

### Python包

需要安装以下Python包：
- `numpy` - 数值计算
- 其他模块可能需要的包

## 注意事项

1. **文件路径**: 程序需要在 `new_src` 目录下运行，确保所有模块文件在同一目录
2. **消息长度**: 建议使用1KB、10KB、100KB等不同长度进行测试，以验证结果的稳定性
3. **随机性**: 仿真结果会有一定的随机性，特别是误码率等指标。增加消息长度可以提高统计准确性
4. **文件清理**: 使用 `-del` 参数可以清理之前的临时文件，确保每次运行都是干净的环境
5. **编码格式**: 所有文件使用UTF-8编码

## 故障排除

1. **模块找不到**: 确保在 `new_src` 目录下运行程序，且所有模块文件存在
2. **文件路径错误**: 检查 `input/` 目录是否存在且包含所需的CSV文件
3. **权限错误**: 确保有写入 `../data/` 目录的权限
4. **编码错误**: 如果遇到编码问题，确保所有文件使用UTF-8编码
5. **计算结果异常**: 
   - 检查输入文件格式是否正确
   - 确认消息长度足够大（建议至少1KB）
   - 使用 `-d` 参数查看详细执行过程

## 示例输出

运行程序后，控制台会输出：
- 每个场景的执行状态
- 各模块的调用情况
- 指标计算结果
- 文件保存位置

最终结果保存在 `../data/metrics/` 目录下的CSV文件中，可以用Excel等工具打开查看和分析。
